{
  "$schema": "http://json.schemastore.org/template",
  "author": "MishaGde",

  "classifications": [
    "FastAPI",
    "Microservice",
    "CleanArchitecture",
    "FastEndpoints",
    "MassTransit",
    "RabbitMQ",
    "EFCore",
    "Redis",
    "Serilog",
    "OpenSearch",
    "Docker",
    "REST",
    "MinimalAPI"
  ],

  "identity": "MishaGde.FastApiMicroserviceTemplate",
  "groupIdentity": "MishaGde.FastApiMicroserviceTemplate.Group",

  "name": "Fast API Microservice Template (FastEndpoints + MassTransit + Postgres + RabbitMQ)",
  "shortName": "fast-api-microservice-template",
  "description": "–ì–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞: FastEndpoints, MassTransit, PostgreSQL, Redis, RabbitMQ, Serilog (OpenSearch), EF Core –º–∏–≥—Ä–∞—Ü–∏–∏, Dockerfile, docker-compose, Mapster, JWT.",
  "precedence": 100,
  "preferNameDirectory": true,

  "sourceName": "TemplateProject",
  "defaultName": "MyMicroservice",

  "symbols": {
    "net": {
      "type": "parameter",
      "datatype": "choice",
      "description": "–í—ã–±–æ—Ä –≤–µ—Ä—Å–∏–∏ .NET",
      "choices": [
        { "choice": "8", "description": ".NET 8 (LTS)" },
        { "choice": "9", "description": ".NET 9" }
      ],
      "defaultValue": "8"
    },

    "use-opentelemetry": {
      "type": "parameter",
      "datatype": "bool",
      "description": "–í–∫–ª—é—á–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É OpenTelemetry?",
      "defaultValue": false
    },

    "use-seq": {
      "type": "parameter",
      "datatype": "bool",
      "description": "–î–æ–±–∞–≤–∏—Ç—å Seq –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ?",
      "defaultValue": false
    },

    "without-sln": {
      "type": "parameter",
      "datatype": "bool",
      "description": "–ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å solution (.sln)?",
      "defaultValue": false
    },

    "projectName": {
      "type": "parameter",
      "datatype": "string",
      "replaces": "TemplateProject",
      "defaultValue": "MyMicroservice",
      "description": "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞"
    }
  },

  "primaryOutputs": [
    { "path": "TemplateProject.Api/TemplateProject.Api.csproj" },
    {
      "condition": "(without-sln == false)",
      "path": "TemplateProject.sln"
    }
  ],

  "sources": [
    {
      "source": "./",
      "target": "./",

      "exclude": [
        "**/[Bb]in/**",
        "**/[Oo]bj/**",
        ".template.config/**",
        ".git/**"
      ],

      "modifiers": [

        {
          "condition": "(use-opentelemetry == false)",
          "exclude": [
            "docker/otel-collector-config.yaml",
            "src/TemplateProject.Api/Telemetry/**",
            "src/TemplateProject.Api/opentelemetry.json"
          ]
        },

        {
          "condition": "(use-seq == false)",
          "exclude": [
            "docker/seq/**",
            "src/TemplateProject.Api/Logging/Seq/**"
          ]
        },

        {
          "condition": "(without-sln == true)",
          "exclude": [ "TemplateProject.sln" ]
        },

        {
          "rename": {
            "TemplateProject.Api": "{{projectName}}.Api",
            "TemplateProject.Application": "{{projectName}}.Application",
            "TemplateProject.Domain": "{{projectName}}.Domain",
            "TemplateProject.Infrastructure": "{{projectName}}.Infrastructure",
            "TemplateProject.Tests": "{{projectName}}.Tests",
            "TemplateProject.sln": "{{projectName}}.sln"
          }
        },

        {
          "replacements": [
            {
              "original": "TemplateProject",
              "replacement": "{{projectName}}"
            }
          ]
        },

        {
          "condition": "(net == '8')",
          "replacements": [
            {
              "original": "TARGET_FRAMEWORK_PLACEHOLDER",
              "replacement": "net8.0"
            }
          ]
        },

        {
          "condition": "(net == '9')",
          "replacements": [
            {
              "original": "TARGET_FRAMEWORK_PLACEHOLDER",
              "replacement": "net9.0"
            }
          ]
        }
      ]
    }
  ],

  "postActions": [

    {
      "condition": "(without-sln == false)",
      "id": "create-sln",
      "description": "–°–æ–∑–¥–∞—Ç—å solution",
      "actionId": "C34F7E9E-4D36-4A8C-A18F-9685ED7B87E5",
      "args": {
        "executable": "dotnet",
        "args": [ "new", "sln", "-n", "{{projectName}}" ]
      },
      "continueOnError": true
    },

    {
      "condition": "(without-sln == false)",
      "id": "add-projects",
      "description": "–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –≤ solution",
      "actionId": "C34F7E9E-4D36-4A8C-A18F-9685ED7B87E5",
      "args": {
        "executable": "dotnet",
        "args": [
          "sln", "{{projectName}}.sln", "add",
          "src/{{projectName}}.Api/{{projectName}}.Api.csproj",
          "src/{{projectName}}.Application/{{projectName}}.Application.csproj",
          "src/{{projectName}}.Infrastructure/{{projectName}}.Infrastructure.csproj",
          "src/{{projectName}}.Domain/{{projectName}}.Domain.csproj",
          "tests/{{projectName}}.Tests/{{projectName}}.Tests.csproj"
        ]
      },
      "continueOnError": true
    },

    {
      "id": "show-summary",
      "description": "–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
      "actionId": "2A7B98D8-5D06-4A5A-9C89-6C4E92A6FB11",
      "manualInstructions": [
        { "text": "üéâ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!" },
        { "text": "üëâ –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã: docker-compose up -d" },
        { "text": "üëâ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π:" },
        { "text": "   dotnet ef database update --project src/{{projectName}}.Infrastructure --startup-project src/{{projectName}}.Api" },
        { "text": "üëâ –ó–∞–ø—É—Å–∫ API:" },
        { "text": "   dotnet run --project src/{{projectName}}.Api" },
        { "text": "üëâ Swagger: http://localhost:5000/swagger" },
        { "condition": "(use-seq == true)", "text": "üëâ Seq: http://localhost:5341" },
        { "condition": "(use-opentelemetry == true)", "text": "üëâ Jaeger: http://localhost:16686" }
      ]
    }
  ]
}
