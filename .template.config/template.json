{
  "$schema": "http://json.schemastore.org/template",
  "author": "MishaGde",

  "classifications": [
    "FastAPI",
    "Microservice",
    "CleanArchitecture",
    "FastEndpoints",
    "MassTransit",
    "RabbitMQ",
    "EFCore",
    "Redis",
    "Serilog",
    "OpenSearch",
    "Docker",
    "REST",
    "MinimalAPI"
  ],

  "identity": "MishaGde.FastApiMicroserviceTemplate",
  "groupIdentity": "MishaGde.FastApiMicroserviceTemplate.Group",

  "name": "Fast API Microservice Template (FastEndpoints + MassTransit + Postgres + RabbitMQ)",
  "shortName": "fast-api-microservice-template",
  "description": "Готовый шаблон микросервиса: FastEndpoints, MassTransit, PostgreSQL, Redis, RabbitMQ, Serilog (OpenSearch), EF Core миграции, Dockerfile, docker-compose, Mapster, JWT.",
  "precedence": 100,
  "preferNameDirectory": true,

  "sourceName": "TemplateProject",
  "defaultName": "MyMicroservice",

  "symbols": {
    "net": {
      "type": "parameter",
      "datatype": "choice",
      "description": "Выбор версии .NET",
      "choices": [
        { "choice": "8", "description": ".NET 8 (LTS)" },
        { "choice": "9", "description": ".NET 9" }
      ],
      "defaultValue": "8"
    },

    "use-opentelemetry": {
      "type": "parameter",
      "datatype": "bool",
      "description": "Включить поддержку OpenTelemetry?",
      "defaultValue": false
    },

    "use-seq": {
      "type": "parameter",
      "datatype": "bool",
      "description": "Добавить Seq в окружение?",
      "defaultValue": false
    },

    "without-sln": {
      "type": "parameter",
      "datatype": "bool",
      "description": "Не создавать solution (.sln)?",
      "defaultValue": false
    },

    "projectName": {
      "type": "bind",
      "binding": "name"
    }
  },

  "primaryOutputs": [
    { "path": "src/TemplateProject.Api/TemplateProject.Api.csproj" },
    {
      "condition": "(without-sln == false)",
      "path": "TemplateProject.sln"
    }
  ],

  "sources": [
    {
      "source": "./content",
      "target": "./",

      "exclude": [
        "**/[Bb]in/**",
        "**/[Oo]bj/**",
        ".git/**"
      ],

      "modifiers": [
        {
          "condition": "(use-opentelemetry == false)",
          "exclude": [
            "docker/otel-collector-config.yaml",
            "src/TemplateProject.Api/Telemetry/**",
            "src/TemplateProject.Api/opentelemetry.json"
          ]
        },
        {
          "condition": "(use-seq == false)",
          "exclude": [
            "docker/seq/**",
            "src/TemplateProject.Api/Logging/Seq/**"
          ]
        },
        {
          "condition": "(without-sln == true)",
          "exclude": [ "TemplateProject.sln" ]
        },
        {
          "replacements": [
            {
              "original": "TemplateProject",
              "replacement": "{{projectName}}"
            }
          ]
        },
        {
          "condition": "(net == '8')",
          "replacements": [
            { "original": "TARGET_FRAMEWORK_PLACEHOLDER", "replacement": "net8.0" }
          ]
        },
        {
          "condition": "(net == '9')",
          "replacements": [
            { "original": "TARGET_FRAMEWORK_PLACEHOLDER", "replacement": "net9.0" }
          ]
        }
      ]
    }
  ],

  "postActions": []
}
